{
    "nodes":[
       {
          "uid":"14w4xxhbk",
          "type":"service_cigam_product_list",
          "trigger":false,
          "data":{
             "x":442,
             "y":1687,
             "output_path":"products",
             "pin_authorization":"{{var pin}}",
             "codigo_material_inicial":"",
             "codigo_material_final":"",
             "client_url_base":"{{var url}}"
          }
       },
       {
          "uid":"j17oti4g0",
          "type":"core_split_message",
          "data":{
             "x":1547,
             "y":1682,
             "items":"filtered_produts",
             "description":"Percorre a lista de produtos",
             "output_path":"product"
          }
       },
       {
          "uid":"5gtu1jckv",
          "type":"core_delay",
          "data":{
             "x":3249,
             "y":1679,
             "delay_in_seconds":"0.1",
             "description":"Delay de 0.1 segundos entre as chamadas"
          }
       },
       {
          "uid":"ukew00ajx",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":3699,
             "y":1588,
             "expression":"msg.floui_product.data.status != \"retry\"",
             "description":"Se produto está ativo no WAKE OU  já existe no banco e integrado"
          }
       },
       {
          "uid":"5eeebvu2o",
          "type":"core_function",
          "data":{
             "x":2947,
             "y":1667,
             "code":"async function handler(msg) {\n    msg.template_product ={\n\n        \"sku\": `${msg.product.codigoMaterial}`,\n        \"nome\":msg.product.descricao,\n        \"custo\": msg.product.precoCusto,\n        \"precoVenda\":msg.product_price.precoUnitario,\n        \"precoDesconto\": msg.product_price.precoDesconto,\n        \"peso\": msg.product.peso,\n        \"altura\": msg.product.altura,\n        \"comprimento\":msg.product.comprimento,\n        \"ean\": msg.product.gtin,\n        \"codigoFiscal\": msg.product.codigoFiscal,\n        \"codigo_fabricante\": msg.product.codigoFabricante,\n        \"variante\": msg.product.utilizaGrade,\n        \"classificacaoAbc\": msg.product.classificacaoAbc\n    }\n\n    return msg;\n}",
             "description":"mapeia os dados do produto num lugar só (template_product)"
          }
       },
       {
          "uid":"behaqw8vk",
          "type":"core_logger",
          "data":{
             "x":3918,
             "y":1573,
             "message_type":"message_parsed_text",
             "message":"Esta no banco floui : SKU - {{msg.template_product.sku}} STATUS: {{msg.floui_product.data.status}}",
             "description":"Log do produto ignorado na integração",
             "label":"Produto ignorado na integração de novos produtos"
          }
       },
       {
          "uid":"lfqpgozt7",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":4563,
             "y":1637,
             "expression":"msg.template_product.variante ==  \"\"",
             "description":"Se somente > 1 produtos de resultado (COM VARIACAO)"
          }
       },
       {
          "uid":"d5x69e4c9",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":4562,
             "y":1830,
             "expression":"msg.template_product.variante !==  \"\"",
             "description":"Se somente > 1 produtos de resultado (COM VARIACAO)"
          }
       },
       {
          "uid":"o5jmi2wod",
          "type":"core_logger",
          "data":{
             "x":1793,
             "y":1837,
             "message_type":"message_parsed_text",
             "message":"Processamento de novos produtos finalizado",
             "label":"",
             "description":"Log de finalização da primeira etapa"
          }
       },
       {
          "uid":"et9pj7lk5",
          "type":"service_internal_db_entity_getbyfield",
          "data":{
             "x":3487,
             "y":1674,
             "table_id":"659c7d463b7d7dc6b43f413b",
             "field":"sku",
             "value":"{{msg.template_product.sku}}",
             "description":"vai consultar o produto",
             "output_path":"floui_product"
          }
       },
       {
          "uid":"40rj9b6v6",
          "type":"core_logger",
          "data":{
             "x":1079,
             "y":1597,
             "message_type":"message_parsed_text",
             "message":"quantidade de  produtos para processar : {{msg.filtered_produts.length}}",
             "description":"Log do número de produtos encontrados"
          }
       },
       {
          "uid":"jwn410iv1",
          "type":"service_wake_commerce_product_create",
          "trigger":false,
          "data":{
             "x":5399,
             "y":1628,
             "comVariacao":"0",
             "valido":"1",
             "exibirMatrizAtributos":"1",
             "precoCusto":"{{msg.template_product.custo}}",
             "exibirSite":"0",
             "condicao":"Novo",
             "trocaGratis":"0",
             "contraProposta":"0",
             "output_path":"wake_product_created",
             "estoque":"{\"6yref44y1\":{\"estoqueFisico\":\"0\",\"estoqueReservado\":\"0\",\"centroDistribuicaoId\":\"0\",\"alertaEstoque\":\"0\"}}",
             "listaAtacado":"{}",
             "listaAtributos":"{}",
             "description":"Criar produto na wake sem variação",
             "token":"{{var wake_token}}",
             "nome":"{{msg.template_product.nome}}",
             "sku":"{{msg.template_product.sku}}",
             "ean":"null",
             "precoDe":"",
             "fabricante":"Fokus",
             "peso":"{{msg.template_product.peso}}",
             "largura":"{{msg.template_product.largura}}",
             "altura":"{{msg.template_product.altura}}",
             "comprimento":"{{msg.template_product.comprimento}}",
             "freteGratis":"Neutro",
             "precoPor":"{{msg.template_product.precoVenda}}",
             "estoque_estoqueFisico_6yref44y1":"0",
             "estoque_estoqueReservado_6yref44y1":"0",
             "estoque_centroDistribuicaoId_6yref44y1":"0",
             "estoque_alertaEstoque_6yref44y1":"0"
          }
       },
       {
          "uid":"x07ij9fdp",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":2685,
             "y":732,
             "expression":"msg.product_price.message",
             "description":"retornou preço do produto?"
          }
       },
       {
          "uid":"7x7mz6k4b",
          "type":"core_logger",
          "data":{
             "x":2967,
             "y":714,
             "message_type":"message_parsed_text",
             "message":"Produto: {{msg.product.codigoMaterial}} sem preço de venda - Retorno: {{msg.product_price.message}}",
             "label":"Produto sem preço de venda",
             "description":"Produto sem preço de venda"
          }
       },
       {
          "uid":"irlxy332j",
          "type":"core_subflow_call",
          "trigger":false,
          "data":{
             "x":2272,
             "y":1687,
             "identifier":"verificarPreco",
             "description":"Verifica o preço"
          }
       },
       {
          "uid":"vmajbwfz3",
          "type":"service_cigam_product_price_get",
          "data":{
             "x":2418,
             "y":824,
             "output_path":"product_price",
             "codigo_tabela":"{{var tabela_preco}}",
             "pin_authorization":"{{var pin}}",
             "codigo_material_inicial":"{{msg.product.codigoMaterial || msg.product.reg.codigoMaterial}}",
             "codigo_material_final":"{{msg.product.codigoMaterial || msg.product.reg.codigoMaterial}}",
             "client_url_base":"{{var url}}"
          }
       },
       {
          "uid":"we0ric95l",
          "type":"core_subflow_output",
          "trigger":false,
          "data":{
             "x":2976,
             "y":840
          }
       },
       {
          "uid":"hsoal3xs1",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":2695,
             "y":841,
             "expression":"!msg.product_price.message",
             "description":"retornou preço do produto?"
          }
       },
       {
          "uid":"p6fssv03s",
          "type":"core_subflow_input",
          "trigger":false,
          "data":{
             "x":2168,
             "y":844,
             "identifier":"verificarPreco"
          }
       },
       {
          "uid":"o1aoa4bin",
          "type":"service_cigam_product_tg_id_list",
          "trigger":false,
          "data":{
             "x":1300,
             "y":1684,
             "pin_authorization":"{{var pin}}",
             "output_path":"id_materiais_tg",
             "client_url_base":"{{var url}}",
             "disabled":false
          }
       },
       {
          "uid":"e55rwcu7i",
          "type":"core_function",
          "data":{
             "x":2062,
             "y":1121,
             "code":"async function handler(msg) {\n    msg.materialsTg = msg.id_materiais_tg.filter((item) => {\n        return item.codigoMaterial == msg.template_product.sku\n    })\n    return msg;\n\n    \n}",
             "description":"filtra o materialTG"
          }
       },
       {
          "uid":"aypz2tlpu",
          "type":"core_subflow_call",
          "trigger":false,
          "data":{
             "x":5392,
             "y":1824,
             "identifier":"materiaisTg"
          }
       },
       {
          "uid":"bzq9d974q",
          "type":"core_subflow_input",
          "trigger":false,
          "data":{
             "x":1830,
             "y":1137,
             "identifier":"materiaisTg"
          }
       },
       {
          "uid":"x2bzc0cya",
          "type":"core_subflow_output",
          "trigger":false,
          "data":{
             "x":2912,
             "y":1248
          }
       },
       {
          "uid":"uck9igl77",
          "type":"service_cigam_product_tg_get",
          "trigger":false,
          "data":{
             "x":2983,
             "y":1111,
             "pin_authorization":"{{var pin}}",
             "codigo_tg":"{{msg.materialTg.codigoTg}}",
             "codigo_categoria":"{{msg.materialTg.codigoCategoria}}",
             "codigo_material":"{{msg.materialTg.codigoMaterial}}",
             "output_path":"materialTG",
             "codigo_empresa":"{{msg.materialTg.codigoEmpresa != \"\" ?  msg.materialTg.codigoEmpresa : \" \"}}",
             "client_url_base":"{{var url}}"
          }
       },
       {
          "uid":"6stxhj0y9",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":3323,
             "y":1221,
             "expression":"msg.materialTG.message == \"A consulta não retornou nenhum registro\" || msg.materialTG.numeracao == \"\""
          }
       },
       {
          "uid":"guukymmxr",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":3224,
             "y":1100,
             "expression":"!msg.materialTG.message && msg.materialTG.numeracao != \"\""
          }
       },
       {
          "uid":"ly19dz1kc",
          "type":"core_logger",
          "data":{
             "x":3610,
             "y":1206,
             "message_type":"message_parsed_text",
             "message":"Produto:  {{msg.product.codigoMaterial}} sem categoria",
             "label":"Produto sem categoria",
             "description":"Produto sem categoria"
          }
       },
       {
          "uid":"r919dcyaw",
          "type":"service_wake_commerce_product_create",
          "trigger":false,
          "data":{
             "x":4124,
             "y":1076,
             "comVariacao":"1",
             "valido":"1",
             "exibirMatrizAtributos":"1",
             "precoCusto":"{{msg.template_product.custo}}",
             "exibirSite":"0",
             "condicao":"Novo",
             "trocaGratis":"0",
             "contraProposta":"0",
             "output_path":"wake_product_created",
             "estoque":"{\"xv1yhte8k\":{\"estoqueFisico\":\"0\",\"estoqueReservado\":\"0\",\"centroDistribuicaoId\":\"0\",\"alertaEstoque\":\"0\"}}",
             "listaAtacado":"{}",
             "listaAtributos":"{}",
             "description":"Criar produto na wake com variação",
             "token":"{{var wake_token}}",
             "nome":"{{msg.template_product.nome}} {{msg.materialTG.numeracao.replace(\"/\", \"-\")}}",
             "sku":"{{msg.product_sku}}",
             "ean":"null",
             "precoDe":"",
             "fabricante":"Fokus",
             "peso":"{{msg.template_product.peso}}",
             "largura":"{{msg.template_product.largura}}",
             "altura":"{{msg.template_product.altura}}",
             "comprimento":"{{msg.template_product.comprimento}}",
             "freteGratis":"Neutro",
             "idPaiExterno":"{{msg.template_product.sku}}",
             "precoPor":"{{msg.template_product.precoVenda}}",
             "estoque_estoqueFisico_xv1yhte8k":"0",
             "estoque_estoqueReservado_xv1yhte8k":"0",
             "estoque_centroDistribuicaoId_xv1yhte8k":"0",
             "estoque_alertaEstoque_xv1yhte8k":"0",
             "disabled":false,
             "nomeProdutoPai":"{{msg.template_product.nome}}"
          }
       },
       {
          "uid":"a6hgw9a5w",
          "type":"core_split_message",
          "data":{
             "x":2666,
             "y":1122,
             "items":"materialsTg",
             "output_path":"materialTg"
          }
       },
       {
          "uid":"ye8q5u6r2",
          "type":"core_logger",
          "data":{
             "x":4653,
             "y":1076,
             "message_type":"message_parsed_text",
             "message":"Status {{msg.response.status}} - ID da variante no Wake Commerce: {{json msg.wake_product_created}} | sku: {{msg.product_sku}}",
             "description":"Log criação de produto variante",
             "label":"comunicação no cadastro de novo produto na Wake Commerce"
          }
       },
       {
          "uid":"s0t3efk83",
          "type":"core_scheduler",
          "trigger":true,
          "data":{
             "x":98,
             "y":1558,
             "schedule_type":"custom_cron",
             "custom_cron_expression":"0 */8 * * *",
             "disabled":false
          }
       },
       {
          "uid":"215in60af",
          "type":"service_internal_db_entity_save",
          "data":{
             "x":4398,
             "y":1076,
             "pk_field":"varianteId",
             "fields":"{\"mb5o2sdjh\":{\"field\":\"sku\",\"value\":\"{{msg.product_sku}}\"},\"dl5opcsg9\":{\"field\":\"varianteId\",\"value\":\"{{msg.wake_product_created}}\"},\"jazzzsxkg\":{\"field\":\"nome\",\"value\":\"{{msg.materialTG.codigoCategoria}}\"},\"6pj9a56mo\":{\"field\":\"codigoMaterial\",\"value\":\"{{msg.template_product.sku}}\"}}",
             "description":"",
             "pk_value":"{{json msg.wake_product_created}}",
             "table_id":"659ef1eca38c2222fc91d0b0",
             "fields_field_mb5o2sdjh":"sku",
             "fields_value_mb5o2sdjh":"{{msg.product_sku}}",
             "fields_field_dl5opcsg9":"varianteId",
             "fields_value_dl5opcsg9":"{{msg.wake_product_created}}",
             "fields_field_jazzzsxkg":"nome",
             "fields_value_jazzzsxkg":"{{msg.materialTG.codigoCategoria}}",
             "fields_field_6pj9a56mo":"codigoMaterial",
             "fields_value_6pj9a56mo":"{{msg.template_product.sku}}"
          }
       },
       {
          "uid":"hgt4ap319",
          "type":"core_function",
          "data":{
             "x":3391,
             "y":1083,
             "code":"async function handler(msg) {\n    msg.product_sku = `${msg.template_product.sku}${msg.materialTG.numeracao != \"\" ? `-${msg.materialTG.numeracao.replace(\"/\", \"-\")}` : \"\"}`\n\n    return msg;\n}",
             "description":"Cria um sku unico para as variantes"
          }
       },
       {
          "uid":"4s5z42whq",
          "type":"core_joint",
          "trigger":false,
          "data":{
             "x":2190,
             "y":289
          }
       },
       {
          "uid":"trnm4l0l4",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":2585,
             "y":184,
             "expression":"msg.response.status == 201 && msg.wake_product_created  || msg.response.status == 200 &&  msg.wake_product_created",
             "description":"Sucesso na criação"
          }
       },
       {
          "uid":"3cvyonyqf",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":2591,
             "y":297,
             "expression":"msg.response.status >= 400 && msg.response.status < 500",
             "description":"Falha de regra de negócio"
          }
       },
       {
          "uid":"jgtfgrr7z",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":2587,
             "y":493,
             "expression":"msg.response.status >= 500",
             "description":"Falha de comunicação"
          }
       },
       {
          "uid":"gimvz7ivi",
          "type":"core_logger",
          "data":{
             "x":2830,
             "y":164,
             "message_type":"message_parsed_text",
             "message":"codigoMaterial: {{msg.template_product.sku}} | {{json msg.wake_product_created}}",
             "description":"Log estruturado de sucesso",
             "label":"Novo produto cadastrado na Wake Commerce"
          }
       },
       {
          "uid":"b0j2yh8sz",
          "type":"core_logger",
          "data":{
             "x":2833,
             "y":280,
             "message_type":"message_parsed_text",
             "message":"Status {{msg.response.status}} codigoMaterial: {{json msg.template_product.sku}} response {{msg.response.statusText}}",
             "description":"Log estruturado da falha",
             "label":"Falha no cadastro de novo produto na Wake Commerce"
          }
       },
       {
          "uid":"5z1a4xtug",
          "type":"core_logger",
          "data":{
             "x":2832,
             "y":479,
             "message_type":"message_parsed_text",
             "message":"Status {{msg.response.status}} - Codigo Material: {{msg.template_product.sku}}",
             "description":"Log estruturado da falha",
             "label":"Falha de comunicação no cadastro de novo produto na Wake Commerce"
          }
       },
       {
          "uid":"232u885w3",
          "type":"service_internal_db_entity_save",
          "data":{
             "x":3050,
             "y":280,
             "table_id":"659c7d463b7d7dc6b43f413b",
             "fields":"{\"3eor7w3fp\":{\"field\":\"sku\",\"value\":\"{{msg.template_product.sku}}\"},\"5cjdysi0c\":{\"field\":\"status\",\"value\":\"error\"}}",
             "pk_field":"sku",
             "pk_value":"{{msg.product.codigoMaterial}}",
             "description":"",
             "fields_value_3eor7w3fp":"{{msg.template_product.sku}}",
             "fields_field_3eor7w3fp":"sku",
             "fields_field_5cjdysi0c":"status",
             "fields_value_5cjdysi0c":"error",
             "output_path":"product_db_item"
          }
       },
       {
          "uid":"8o10bigr5",
          "type":"service_internal_db_entity_save",
          "data":{
             "x":3057,
             "y":165,
             "table_id":"659c7d463b7d7dc6b43f413b",
             "fields":"{\"3eor7w3fp\":{\"field\":\"sku\",\"value\":\"{{msg.template_product.sku}}\"},\"5cjdysi0c\":{\"field\":\"status\",\"value\":\"integrado\"}}",
             "pk_field":"sku",
             "pk_value":"{{msg.product.codigoMaterial}}",
             "description":"",
             "fields_value_3eor7w3fp":"{{msg.template_product.sku}}",
             "fields_field_3eor7w3fp":"sku",
             "fields_field_5cjdysi0c":"status",
             "fields_value_5cjdysi0c":"integrado",
             "output_path":"product_db_item"
          }
       },
       {
          "uid":"rnjyto1fq",
          "type":"service_internal_db_entity_save",
          "data":{
             "x":3052,
             "y":477,
             "table_id":"659c7d463b7d7dc6b43f413b",
             "fields":"{\"3eor7w3fp\":{\"field\":\"sku\",\"value\":\"{{msg.template_product.sku}}\"},\"5cjdysi0c\":{\"field\":\"status\",\"value\":\"retry\"}}",
             "pk_field":"sku",
             "pk_value":"{{msg.product.codigoMaterial}}",
             "description":"",
             "fields_value_3eor7w3fp":"{{msg.template_product.sku}}",
             "fields_field_3eor7w3fp":"sku",
             "fields_field_5cjdysi0c":"status",
             "fields_value_5cjdysi0c":"retry",
             "output_path":"product_db_item"
          }
       },
       {
          "uid":"64xnb72m6",
          "type":"core_subflow_input",
          "trigger":false,
          "data":{
             "x":1504,
             "y":281,
             "identifier":"escreverLog"
          }
       },
       {
          "uid":"4kq5f9okg",
          "type":"core_subflow_call",
          "trigger":false,
          "data":{
             "x":5606,
             "y":1745,
             "identifier":"escreverLog"
          }
       },
       {
          "uid":"362m99lpb",
          "type":"core_subflow_output",
          "trigger":false,
          "data":{
             "x":3371,
             "y":294
          }
       },
       {
          "uid":"fihl0pdei",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":2395,
             "y":1138,
             "expression":"msg.materialsTg.length > 0",
             "description":"Achou materialTG"
          }
       },
       {
          "uid":"aev5k5m8s",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":2398,
             "y":1258,
             "expression":"msg.materialsTg.length == 0",
             "description":"Não achou materialTG"
          }
       },
       {
          "uid":"8fvcrhum3",
          "type":"core_logger",
          "data":{
             "x":2653,
             "y":1241,
             "message_type":"message_parsed_text",
             "message":"CodigoProduto: {{msg.template_product.sku}} não tem materialTG",
             "label":"Produto não tem códigoTG",
             "description":"Produto não tem códigoTG"
          }
       },
       {
          "uid":"y681288ys",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":3752,
             "y":1694,
             "expression":"!msg.floui_product  || msg.floui_product.data.status == \"retry\"",
             "description":"Se produto não está ativo no ERP OU  já existe no banco e integrado"
          }
       },
       {
          "uid":"prg2wb4s0",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":4260,
             "y":1697,
             "expression":"msg.template_product.classificacaoAbc.toUpperCase()  == \"F\"",
             "description":"classificação ABC = F"
          }
       },
       {
          "uid":"rp8ysvhop",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":3934,
             "y":1765,
             "expression":"msg.template_product.classificacaoAbc.toUpperCase()  != \"F\"",
             "description":"classificaçãoABC  != F"
          }
       },
       {
          "uid":"jdfnlrt18",
          "type":"core_logger",
          "data":{
             "x":4096,
             "y":1752,
             "message_type":"message_parsed_text",
             "message":"ClassificaçãoABC diferente de F: SKU - {{msg.template_product.sku}}  - classABC - {{msg.template_product.classificacaoAbc}}",
             "description":"Log do produto ignorado na integração",
             "label":"ClassificaçãoABC diferente de F"
          }
       },
       {
          "uid":"jqee0x0iq",
          "type":"core_delay",
          "data":{
             "x":4760,
             "y":1640,
             "delay_in_seconds":"0.5",
             "description":"Espera entre chamadas de 0.5 segundos"
          }
       },
       {
          "uid":"vr1q2ydhh",
          "type":"core_delay",
          "data":{
             "x":4791,
             "y":1829,
             "delay_in_seconds":"0.5",
             "description":"Espera entre chamadas de 0.5 segundos"
          }
       },
       {
          "uid":"hfxx1hgqw",
          "type":"service_wake_commerce_product_get",
          "trigger":false,
          "data":{
             "x":4978,
             "y":1626,
             "output_path":"validate_product_wake",
             "token":"{{var wake_token}}",
             "sku":"{{msg.template_product.nome}}"
          }
       },
       {
          "uid":"m2qyt52ah",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":5190,
             "y":1561,
             "expression":"msg.validate_product_wake.produtoVarianteId"
          }
       },
       {
          "uid":"ta5g4krct",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":5183,
             "y":1642,
             "expression":"!msg.validate_product_wake.produtoVarianteId",
             "disabled":false
          }
       },
       {
          "uid":"td50iyz64",
          "type":"core_logger",
          "data":{
             "x":5389,
             "y":1493,
             "message_type":"message_parsed_text",
             "message":"SKU - {{msg.template_product.sku}} já cadastrado na wake",
             "description":"Log do produto ignorado na integração",
             "label":"Produto ja cadastrado na wake"
          }
       },
       {
          "uid":"9fk8gyy89",
          "type":"service_wake_commerce_product_get",
          "trigger":false,
          "data":{
             "x":3607,
             "y":1077,
             "output_path":"validate_product_wake2",
             "token":"{{var wake_token}}",
             "sku":"{{msg.product_sku}}"
          }
       },
       {
          "uid":"wyxa37x5l",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":3867,
             "y":941,
             "expression":"msg.validate_product_wake2.produtoVarianteId"
          }
       },
       {
          "uid":"1n31w5gxi",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":3856,
             "y":1095,
             "expression":"!msg.validate_product_wake2.produtoVarianteId"
          }
       },
       {
          "uid":"lrqv90ife",
          "type":"core_logger",
          "data":{
             "x":4120,
             "y":920,
             "message_type":"message_parsed_text",
             "message":"SKU - {{msg.product_sku}} já cadastrado na wake",
             "description":"Log do produto ignorado na integração",
             "label":"Produto ja cadastrado na wake"
          }
       },
       {
          "uid":"a5ulz3r02",
          "type":"core_function",
          "data":{
             "x":841,
             "y":1684,
             "code":"async function handler(msg) {\n\n    const filtered_produts  = msg.products.reg.filter((a)=>a.classificacaoAbc.toUpperCase() == \"F\")\n\n    msg.filtered_produts = filtered_produts\n\n    delete msg.products\n    return msg;\n}"
          }
       },
       {
          "uid":"a5kzjdaai",
          "type":"core_function",
          "data":{
             "x":-829,
             "y":1949,
             "code":"async function handler(msg) {\n    msg.lista_skus = msg.payload.lista_skus.split(\"\\n\");\n\n    // var tmpProducts = []\n    // msg.products_response.reg.forEach(item => {\n    //     if (msg.lista_skus.indexOf(item.codigoMaterial) != -1) {\n    //         tmpProducts.push(item)\n    //     }\n    // })\n    // delete msg.products_response\n    // msg.products.reg = tmpProducts\n\n    return msg;\n}"
          }
       },
       {
          "uid":"90g0h61tm",
          "type":"core_form",
          "trigger":true,
          "data":{
             "x":-1021,
             "y":1950,
             "form_id":"65b2647ee6a3bc83ee83fedc"
          }
       },
       {
          "uid":"z125wyxjt",
          "type":"service_cigam_product_list",
          "trigger":false,
          "data":{
             "x":198,
             "y":1988,
             "pin_authorization":"{{var pin}}",
             "client_url_base":"{{var url}}",
             "output_path":"products",
             "codigo_material_inicial":"{{msg.sku}}",
             "codigo_material_final":"{{msg.sku}}"
          }
       },
       {
          "uid":"zcgy1sfux",
          "type":"core_split_message",
          "data":{
             "x":-636,
             "y":1949,
             "items":"lista_skus",
             "output_path":"sku"
          }
       },
       {
          "uid":"jb2yadtvv",
          "type":"core_function",
          "data":{
             "x":623,
             "y":1975,
             "code":"async function handler(msg) {\n    if (!Array.isArray(msg.products.reg)) {\n        msg.products.reg = [msg.products.reg]\n    }\n    return msg;\n}"
          }
       },
       {
          "uid":"84wvwdmpx",
          "type":"service_internal_db_entity_list",
          "data":{
             "x":-413,
             "y":1938,
             "page":"1",
             "limit":"10",
             "description":"",
             "filters":"{\"t3yqv7l2t\":{\"field\":\"data.sku\",\"operator\":\"eq\",\"value\":\"{{msg.sku}}\"}}",
             "sort_order":"{}",
             "filters_field_t3yqv7l2t":"data.sku",
             "filters_operator_t3yqv7l2t":"eq",
             "filters_value_t3yqv7l2t":"{{msg.sku}}",
             "table_id":"659c7d463b7d7dc6b43f413b",
             "output_path":"db_item_form"
          }
       },
       {
          "uid":"npzgpgesd",
          "type":"service_internal_db_entity_delete",
          "data":{
             "x":-15,
             "y":1883,
             "entity_id":"{{msg.db_item_form.items[0]._id}}"
          }
       },
       {
          "uid":"bt23bg4hw",
          "type":"core_debugger",
          "data":{
             "x":-211,
             "y":1837,
             "message_type":"msg_object",
             "message":"Log message"
          }
       },
       {
          "uid":"mqdyjf1yl",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":-175,
             "y":1924,
             "expression":"msg.db_item_form.items.length > 0"
          }
       },
       {
          "uid":"w9olza5n8",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":-184,
             "y":2007,
             "expression":"msg.db_item_form.items.length == 0"
          }
       },
       {
          "uid":"y3usrq92i",
          "type":"core_condition",
          "trigger":false,
          "data":{
             "x":2594,
             "y":399,
             "expression":"msg.response.status == 201 && !msg.wake_product_created  || msg.response.status == 200 &&  !msg.wake_product_created",
             "description":"Erro na criação"
          }
       },
       {
          "uid":"s9npsfxr3",
          "type":"core_logger",
          "data":{
             "x":2832,
             "y":382,
             "message_type":"message_parsed_text",
             "message":"codigoMaterial: {{msg.template_product.sku}} | {{json msg.wake_product_created}}",
             "description":"Log estruturado de erro",
             "label":"Erro ao cadastrar produto"
          }
       },
       {
          "uid":"ihney07q4",
          "type":"service_internal_db_entity_save",
          "data":{
             "x":3058,
             "y":380,
             "table_id":"659c7d463b7d7dc6b43f413b",
             "fields":"{\"3eor7w3fp\":{\"field\":\"sku\",\"value\":\"{{msg.template_product.sku}}\"},\"5cjdysi0c\":{\"field\":\"status\",\"value\":\"retry\"}}",
             "pk_field":"sku",
             "pk_value":"{{msg.product.codigoMaterial}}",
             "description":"",
             "fields_value_3eor7w3fp":"{{msg.template_product.sku}}",
             "fields_field_3eor7w3fp":"sku",
             "fields_field_5cjdysi0c":"status",
             "fields_value_5cjdysi0c":"retry",
             "output_path":"product_db_item"
          }
       },
       {
          "uid":"iph8m99rw",
          "type":"core_logger",
          "data":{
             "x":1841,
             "y":268,
             "message_type":"message_parsed_text",
             "message":"{{json msg.template_product}}",
             "label":"Log template_product",
             "description":"Log para ver se o template_product"
          }
       },
       {
          "uid":"lfor2kg54",
          "type":"core_manual_trigger",
          "trigger":true,
          "data":{
             "x":87,
             "y":1688,
             "enable_form":"0",
             "disabled":false
          }
       },
       {
          "uid":"c98upccqx",
          "type":"core_debugger",
          "data":{
             "x":1541,
             "y":1555,
             "message_type":"message_parsed_text",
             "message":"passei da grade"
          }
       },
       {
          "uid":"pi9w3fkkb",
          "type":"core_debugger",
          "data":{
             "x":3396,
             "y":1537,
             "message_type":"message_parsed_text",
             "message":"passei do template product"
          }
       },
       {
          "uid":"8ediwaulf",
          "type":"core_debugger",
          "data":{
             "x":4526,
             "y":1493,
             "message_type":"message_parsed_text",
             "message":"verificou curva abc"
          }
       },
       {
          "uid":"soc7w7hx3",
          "type":"core_debugger",
          "data":{
             "x":5119,
             "y":1916,
             "message_type":"message_parsed_text",
             "message":"possui grade"
          }
       },
       {
          "uid":"gxsf8z1bc",
          "type":"core_debugger",
          "data":{
             "x":2338,
             "y":1037,
             "message_type":"message_parsed_text",
             "message":"filtrou materialTG"
          }
       },
       {
          "uid":"xz26c67bx",
          "type":"core_debugger",
          "data":{
             "x":3223,
             "y":986,
             "message_type":"message_parsed_text",
             "message":"CONSULTOU PRODUTO MATERIAL TG"
          }
       },
       {
          "uid":"x66onwwwz",
          "type":"core_debugger",
          "data":{
             "x":2697,
             "y":935,
             "message_type":"message_parsed_text",
             "message":"Verificou preço de venda"
          }
       }
    ],
    "connections":[
       {
          "uid":"m1xbar7yw",
          "from":"ukew00ajx",
          "to":"behaqw8vk"
       },
       {
          "uid":"ergvoanek",
          "from":"5gtu1jckv",
          "to":"et9pj7lk5"
       },
       {
          "uid":"ly6dte5km",
          "from":"et9pj7lk5",
          "to":"ukew00ajx"
       },
       {
          "uid":"hg1ln25if",
          "from":"5eeebvu2o",
          "to":"5gtu1jckv"
       },
       {
          "uid":"tiocl0jm4",
          "from":"x07ij9fdp",
          "to":"7x7mz6k4b"
       },
       {
          "uid":"ylouhq9es",
          "from":"vmajbwfz3",
          "to":"x07ij9fdp"
       },
       {
          "uid":"7yovodb74",
          "from":"vmajbwfz3",
          "to":"hsoal3xs1"
       },
       {
          "uid":"u4wqha1p1",
          "from":"hsoal3xs1",
          "to":"we0ric95l"
       },
       {
          "uid":"v17lo8qwa",
          "from":"j17oti4g0",
          "to":"irlxy332j"
       },
       {
          "uid":"0bknf3ucm",
          "from":"p6fssv03s",
          "to":"vmajbwfz3"
       },
       {
          "uid":"7rlc4s34j",
          "from":"o1aoa4bin",
          "to":"j17oti4g0"
       },
       {
          "uid":"ipalwiozj",
          "from":"uck9igl77",
          "to":"6stxhj0y9"
       },
       {
          "uid":"0pczoz6p9",
          "from":"uck9igl77",
          "to":"guukymmxr"
       },
       {
          "uid":"18rhiqss2",
          "from":"irlxy332j",
          "to":"5eeebvu2o"
       },
       {
          "uid":"81rdrnmjr",
          "from":"j17oti4g0_on_end",
          "to":"o5jmi2wod"
       },
       {
          "uid":"ww8clv9w8",
          "from":"bzq9d974q",
          "to":"e55rwcu7i"
       },
       {
          "uid":"g3jxz6oxk",
          "from":"a6hgw9a5w",
          "to":"uck9igl77"
       },
       {
          "uid":"w8vzlqspt",
          "from":"6stxhj0y9",
          "to":"ly19dz1kc"
       },
       {
          "uid":"5nussl049",
          "from":"r919dcyaw",
          "to":"215in60af"
       },
       {
          "uid":"yhi7bgu87",
          "from":"guukymmxr",
          "to":"hgt4ap319"
       },
       {
          "uid":"z7sygpn9w",
          "from":"215in60af",
          "to":"ye8q5u6r2"
       },
       {
          "uid":"hzu13feu3",
          "from":"trnm4l0l4",
          "to":"gimvz7ivi"
       },
       {
          "uid":"mrl5ike6y",
          "from":"3cvyonyqf",
          "to":"b0j2yh8sz"
       },
       {
          "uid":"v9tk95ozf",
          "from":"jgtfgrr7z",
          "to":"5z1a4xtug"
       },
       {
          "uid":"f5ly7mk7z",
          "from":"4s5z42whq",
          "to":"trnm4l0l4"
       },
       {
          "uid":"0lh9vwuc7",
          "from":"4s5z42whq",
          "to":"3cvyonyqf"
       },
       {
          "uid":"xav0pnl6o",
          "from":"4s5z42whq",
          "to":"jgtfgrr7z"
       },
       {
          "uid":"l3vrib4hc",
          "from":"gimvz7ivi",
          "to":"8o10bigr5"
       },
       {
          "uid":"7sn6i84ng",
          "from":"b0j2yh8sz",
          "to":"232u885w3"
       },
       {
          "uid":"t3yqp9ocq",
          "from":"5z1a4xtug",
          "to":"rnjyto1fq"
       },
       {
          "uid":"k6yoqnkuz",
          "from":"jwn410iv1",
          "to":"4kq5f9okg"
       },
       {
          "uid":"4zy7napep",
          "from":"8o10bigr5",
          "to":"362m99lpb"
       },
       {
          "uid":"nyf6r1cah",
          "from":"rnjyto1fq",
          "to":"362m99lpb"
       },
       {
          "uid":"zpncykgdb",
          "from":"232u885w3",
          "to":"362m99lpb"
       },
       {
          "uid":"bmnuzeuu5",
          "from":"aypz2tlpu",
          "to":"4kq5f9okg"
       },
       {
          "uid":"2vs7fabbm",
          "from":"fihl0pdei",
          "to":"a6hgw9a5w"
       },
       {
          "uid":"r8gq862y2",
          "from":"aev5k5m8s",
          "to":"8fvcrhum3"
       },
       {
          "uid":"i8i3d42mn",
          "from":"e55rwcu7i",
          "to":"fihl0pdei"
       },
       {
          "uid":"dacaaxo7n",
          "from":"e55rwcu7i",
          "to":"aev5k5m8s"
       },
       {
          "uid":"ouxy66tt1",
          "from":"y681288ys",
          "to":"prg2wb4s0"
       },
       {
          "uid":"d0qhso6dn",
          "from":"prg2wb4s0",
          "to":"lfqpgozt7"
       },
       {
          "uid":"1l9dewlfg",
          "from":"prg2wb4s0",
          "to":"d5x69e4c9"
       },
       {
          "uid":"87cu7synn",
          "from":"y681288ys",
          "to":"rp8ysvhop"
       },
       {
          "uid":"z1qk6chls",
          "from":"rp8ysvhop",
          "to":"jdfnlrt18"
       },
       {
          "uid":"rqqmo249q",
          "from":"lfqpgozt7",
          "to":"jqee0x0iq"
       },
       {
          "uid":"lf5h8c92z",
          "from":"d5x69e4c9",
          "to":"vr1q2ydhh"
       },
       {
          "uid":"h4jgexqte",
          "from":"vr1q2ydhh",
          "to":"aypz2tlpu"
       },
       {
          "uid":"4oo86heqe",
          "from":"et9pj7lk5",
          "to":"y681288ys"
       },
       {
          "uid":"p5a6ytks2",
          "from":"hfxx1hgqw",
          "to":"m2qyt52ah"
       },
       {
          "uid":"ccsy100w5",
          "from":"hfxx1hgqw",
          "to":"ta5g4krct"
       },
       {
          "uid":"v460f1s4s",
          "from":"jqee0x0iq",
          "to":"hfxx1hgqw"
       },
       {
          "uid":"f87tvy4p6",
          "from":"ta5g4krct",
          "to":"jwn410iv1"
       },
       {
          "uid":"1v9huyy8y",
          "from":"m2qyt52ah",
          "to":"td50iyz64"
       },
       {
          "uid":"p5a6ytks2",
          "from":"9fk8gyy89",
          "to":"wyxa37x5l"
       },
       {
          "uid":"ccsy100w5",
          "from":"9fk8gyy89",
          "to":"1n31w5gxi"
       },
       {
          "uid":"yoth9300k",
          "from":"hgt4ap319",
          "to":"9fk8gyy89"
       },
       {
          "uid":"au5xnhs5r",
          "from":"1n31w5gxi",
          "to":"r919dcyaw"
       },
       {
          "uid":"k2cdc8psn",
          "from":"wyxa37x5l",
          "to":"lrqv90ife"
       },
       {
          "uid":"5qddtzrnp",
          "from":"14w4xxhbk",
          "to":"a5ulz3r02"
       },
       {
          "uid":"5l8dp129u",
          "from":"a5ulz3r02",
          "to":"o1aoa4bin"
       },
       {
          "uid":"l3xl0ibuk",
          "from":"a5ulz3r02",
          "to":"40rj9b6v6"
       },
       {
          "uid":"uugjf4jsz",
          "from":"90g0h61tm",
          "to":"a5kzjdaai"
       },
       {
          "uid":"ytzv1tu3r",
          "from":"a5kzjdaai",
          "to":"zcgy1sfux"
       },
       {
          "uid":"wvzji2ao1",
          "from":"z125wyxjt",
          "to":"jb2yadtvv"
       },
       {
          "uid":"asyxm59vz",
          "from":"jb2yadtvv",
          "to":"a5ulz3r02"
       },
       {
          "uid":"wi7vtcfa7",
          "from":"s0t3efk83",
          "to":"14w4xxhbk"
       },
       {
          "uid":"fn1cvy1dj",
          "from":"zcgy1sfux",
          "to":"84wvwdmpx"
       },
       {
          "uid":"ylfaoeup2",
          "from":"npzgpgesd",
          "to":"z125wyxjt"
       },
       {
          "uid":"hwb49v9wz",
          "from":"84wvwdmpx",
          "to":"bt23bg4hw"
       },
       {
          "uid":"idb8n4ek3",
          "from":"84wvwdmpx",
          "to":"mqdyjf1yl"
       },
       {
          "uid":"yk983pbkz",
          "from":"mqdyjf1yl",
          "to":"npzgpgesd"
       },
       {
          "uid":"5xlya9m9v",
          "from":"84wvwdmpx",
          "to":"w9olza5n8"
       },
       {
          "uid":"9e0u0b59n",
          "from":"w9olza5n8",
          "to":"z125wyxjt"
       },
       {
          "uid":"hzu13feu3",
          "from":"y3usrq92i",
          "to":"s9npsfxr3"
       },
       {
          "uid":"l3vrib4hc",
          "from":"s9npsfxr3",
          "to":"ihney07q4"
       },
       {
          "uid":"n7jj4ftjv",
          "from":"4s5z42whq",
          "to":"y3usrq92i"
       },
       {
          "uid":"4jpc3ffvx",
          "from":"a6hgw9a5w_on_end",
          "to":"x2bzc0cya"
       },
       {
          "uid":"0qxj2lqsw",
          "from":"64xnb72m6",
          "to":"iph8m99rw"
       },
       {
          "uid":"6ijsv6kl8",
          "from":"iph8m99rw",
          "to":"4s5z42whq"
       },
       {
          "uid":"t2z8g05qo",
          "from":"lfor2kg54",
          "to":"14w4xxhbk"
       },
       {
          "uid":"s3dchvfe0",
          "from":"ihney07q4",
          "to":"362m99lpb"
       },
       {
          "uid":"paclvbklp",
          "from":"o1aoa4bin",
          "to":"c98upccqx"
       },
       {
          "uid":"w4y4x5ee3",
          "from":"5eeebvu2o",
          "to":"pi9w3fkkb"
       },
       {
          "uid":"j9ubl6wls",
          "from":"prg2wb4s0",
          "to":"8ediwaulf"
       },
       {
          "uid":"6v4rbuvhq",
          "from":"vr1q2ydhh",
          "to":"soc7w7hx3"
       },
       {
          "uid":"b1cnfb27x",
          "from":"e55rwcu7i",
          "to":"gxsf8z1bc"
       },
       {
          "uid":"eoopkbb9a",
          "from":"uck9igl77",
          "to":"xz26c67bx"
       },
       {
          "uid":"pn3prnnsm",
          "from":"vmajbwfz3",
          "to":"x66onwwwz"
       }
    ],
    "data":{
       "zoom":1,
       "x":66,
       "y":-1349,
       "exported_at":"2024-02-26 14:31:11"
    },
    
    "variables":[
       {
          "key":"wake_commerce_token",
          "value":"fokus-85cf9c81-9ab3-41d5-a90d-700f50787733v",
          "_id":"65073d4d2a24f128fb5bf2ba"
       },
       {
          "key":"pin",
          "value":"001",
          "_id":"655f95685ea010eb1e4ae9ec"
       },
       {
          "key":"tabela_preco",
          "value":"001",
          "_id":"6596b551af2a6228c029af0a"
       },
       {
          "key":"wake_token",
          "value":"fokus-85cf9c81-9ab3-41d5-a90d-700f50787733",
          "_id":"65073d4d2a24f128fb5bf2ba"
       },
       {
          "key":"pin",
          "value":"001",
          "_id":"655f95685ea010eb1e4ae9ec"
       },
       {
          "key":"tabela_preco",
          "value":"001",
          "_id":"6596b551af2a6228c029af0a"
       },
       {
          "key":"url",
          "value":"http://fokuscloud.ddns.com.br:81/webservice/Cigam/Integrador",
          "_id":"65a95791e6a3bc83ee83d737"
       }
    ]
 }